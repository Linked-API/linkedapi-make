[
  {
    "url": "/workflows",
    "method": "POST",
    "headers": {
      "linked-api-token": "{{connection.linkedApiToken}}",
      "identification-token": "{{connection.identificationToken}}"
    },
    "body": {
      "actionType": "st.checkConnectionStatus",
      "personUrl": "{{parameters.personUrl}}"
    },
    "response": {
      "temp": {
        "workflowId": "{{body.result.workflowId}}",
        "workflowStatus": "{{body.result.workflowStatus}}"
      }
    }
  },
  {
    "url": "/workflows/{{temp.workflowId}}",
    "method": "GET",
    "headers": {
      "linked-api-token": "{{connection.linkedApiToken}}",
      "identification-token": "{{connection.identificationToken}}"
    },
    "repeat": {
      "condition": "{{body.result.workflowStatus !== 'completed' && body.result.workflowStatus !== 'failed'}}",
      "delay": 2000,
      "limit": 1800
    },
    "response": {
      "temp": {
        "workflowId": "{{body.result.workflowId}}",
        "workflowStatus": "{{body.result.workflowStatus}}",
        "completion": "{{body.result.completion}}"
      }
    }
  },
  {
    "response": {
      "valid": "{{temp.workflowStatus === 'completed'}}",
      "error": {
        "message": "{{if(temp.workflowStatus === 'failed', 'Workflow failed', 'Workflow timed out')}}"
      },
      "output": "{{temp.completion}}"
    }
  }
]
